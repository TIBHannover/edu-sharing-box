---
- hosts: all
  roles:
    - role: set-timezone
      become: yes
    - role: init-facts
    - role: init-script-dir
  tags:
    - root-task

- hosts: edusharing,educonnector
  become: yes
  roles:
    - apache
  tags:
    - root-task
    - apache

- hosts: edusharing,educonnector,opencast,antivirus
  become: yes
  roles:
    - role: geerlingguy.docker
      vars:
        docker_users:
          - "{{ work_user | default('vagrant')  }}"
  tags:
    - docker-installation
    - docker
    - root-task

- hosts: edusharing
  roles:
    - role: java
      become: yes
      tags: [java]
    - role: edu-sharing-init
      tags: 
        - edu-sharing-init
    - role: edu-sharing-migration
      tags: 
        - edu-sharing-migration
    - role: edu-sharing-customization
      tags: 
        - edu-sharing-customization
    - role: edu-sharing-rendering-service
      tags: 
        - edu-sharing-rendering-service
    - role: edu-sharing-search-elastic
      tags: 
        - edu-sharing-search-elastic
    - role: edu-sharing-search-solr
      tags: 
        - edu-sharing-search-solr
    - role: edu-sharing-notification
      when:
        ( edu_version is defined and  (edu_version | regex_replace('-RC[0-9]+', '') ) is version_compare('9.0.0', '>'))
        and (enable_notification_service is defined and enable_notification_service)
      tags:
        - edu-sharing-notification
    - role: edu-sharing-custom-amp
      tags:
        - edu-sharing-custom-amp
    - role: edu-sharing-classification-keywords
      tags: 
        - edu-sharing-classification-keywords
    - role: edu-sharing-mirror-vocabs
      tags: 
        - edu-sharing-mirror-vocabs
    - role: edu-sharing-backup
      tags:
        - edu-sharing-backup
    - role: edu-sharing-restore
      when: edu_sharing_restore_from_backup is defined and edu_sharing_restore_from_backup
      tags:
        - edu-sharing-restore
    - role: edu-sharing-splash
      when: install_splash is defined and install_splash
      tags: 
        - edu-sharing-splash

- hosts: opencast
  roles:
    - role: opencast-import
      when: install_opencast_importer is defined and install_opencast_importer
  tags:
    - opencast

- hosts: educonnector
  roles:
    - role: edu-connector
      when: enable_edu_connector is defined and enable_edu_connector
  tags:
    - edu-connector

- hosts: edusharing
  become: yes
  roles:
    - role: shibboleth
      when: install_shibboleth is defined and install_shibboleth
      tags: shibboleth
  tags:
    - root-task

- hosts: antivirus
  roles:
    - role: antivirus-clamav
      when: install_antivirus is defined and install_antivirus
  tags:
    - antivirus-clamav